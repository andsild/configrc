set editor="nvim"

set folder           = /extra/.mail                  # Mailbox location
set header_cache     = ~/.mutt/cache/headers    # Where to store headers
set message_cachedir = ~/.mutt/cache/bodies     # Where to store bodies
set certificate_file = ~/.mutt/certificates     # Where to store certs
set mailcap_path=~/.mutt/mailcap          # Entries for filetypes
#set tmpdir           = ~/.mutt/temp             # Where to keep temp files
set signature        = "~/.mutt/bin/signature|" # My signature file

unset wait_key                                  # Makes shelling out less annoying
set mbox_type = Maildir                         # The default Maildir type
set timeout = 3                                 # Idle time before looking for new email
set mail_check = 0                              # How often to look for new email
set move = no                                   # Don't move mail from spool (Gmail already does it)
set delete = no                                # Don't ask for confirmation on delete
set confirmappend = no                          # Don't ask when appending messages to a mailbox
set quit = yes                                  # Don't ask for confirmation when quiting
set mark_old = no                               # I don't use old messages - read and new are good enough for me
set beep_new = yes                              # Beep on new mail
set pipe_decode = no
set thorough_search
set sleep_time = 0                              # Don't sleep when showing messages

set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

ignore *                                        # Ignore all headers
unignore from: to: cc: date: subject:           # Show only these
unhdr_order *                                   # Some distros order things by default
hdr_order from: to: cc: date: subject:          # Use this order by default

set date_format = "%d-%m-%y"                    # Date format
set index_format = "[%Z]  %D  %-20.20F  %s"
set sort = threads                              # Sort like gmail
set sort_aux = reverse-last-date-received       # Sort like gmail
set uncollapse_jump                             # Don't collapse on an unread message
set sort_re                                     # Thread based on regex
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

set pager_index_lines = 7                       # Number of index lines to show
set pager_context = 3                           # Number of context lines to show
set pager_stop = yes                            # Don't go to next message once it has been scrolled through
set menu_scroll = yes                           # Scroll in menus
set tilde = yes                                 # Show tildes after end of messages (like in Vim)
set markers = no                                # No ugly plus signs on wrapped lines

set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
alternative_order text/plain text/enriched text/html

set envelope_from                               # Which from?
set sig_dashes                                  # Dashes before sig
set edit_headers                                # Show headers when composing
set fast_reply                                  # Skip to compose when replying
#set fcc_attach                                  # Save attachments with the body
unset mime_forward                              # Forward attachments as part of body
set forward_format = "Fwd: %s"                  # Format of subject when forwarding
set forward_decode                              # Decode when forwarding
set attribution = "On %d, %n wrote:"            # Format of quoting header
set reply_to                                    # Reply to Reply to: field
set reverse_name                                # Reply as whomever it was to
set include                                     # Include message in replies
set forward_quote                               # Include message in forwards

set sendmail = "~/.mutt/bin/sendmail $my_profile"
set sendmail_wait = 0
unset record

set charset="UTF-8"
set send_charset="utf-8"

# Unbind a bunch of stuff I don't use
bind index,pager \Ce        noop # edit-type                       edit attachment content type
bind index,pager \Cf        noop # forget-passphrase               wipe passphrase(s) from memory
bind index,pager \Ck        noop # extract-keys                    extract supported public keys
bind index,pager \Ct        noop # untag-pattern                   untag messages matching a pattern
bind index,pager <Esc><Tab> noop # previous-new-then-unread        jump to the previous new or unread message
bind index,pager <Esc>C     noop # decode-copy                     make decoded (text/plain) copy
bind index,pager <Esc>D     noop # delete-subthread                delete all messages in a subthread
bind index,pager <Esc>P     noop # check-traditional-pgp           check for classic PGP
bind index,pager <Esc>b     noop # <search>~b                      search in message bodies
bind index,pager <Esc>c     noop # change-folder-readonly          open a different folder in read only mode
bind index,pager <Esc>k     noop # mail-key                        mail a PGP public key
bind index,pager <Esc>n     noop # next-subthread                  jump to the next subthread
bind index,pager <Esc>p     noop # previous-subthread              jump to previous subthread
bind index,pager <Esc>r     noop # read-subthread                  mark the current subthread as read
bind index,pager <Esc>s     noop # decode-save                     make decoded copy (text/plain) and delete
bind index,pager <Esc>t     noop # tag-thread                      tag the current thread
bind index,pager <Esc>u     noop # undelete-subthread              undelete all messages in subthread
bind index,pager <Esc>v     noop # collapse-thread                 collapse/uncollapse current thread
bind index,pager <Space>    noop # collapse-thread                 collapse/uncollapse current thread
bind index,pager $          noop # sync-mailbox                    save changes to mailbox
bind index,pager %          noop # toggle-write                    toggle whether the mailbox will be rewritten
bind index,pager &          noop # link-threads                    link tagged message to the current one
bind index,pager D          noop # delete-pattern                  delete messages matching a pattern
bind index,pager L          noop # list-reply                      reply to specified mailing list
bind index,pager P          noop # parent-message                  jump to parent message in thread
bind index,pager T          noop # tag-pattern                     tag messages matching a pattern
bind index,pager U          noop # undelete-pattern                undelete messages matching a pattern
bind index,pager V          noop # show-version                    show the Mutt version number and date
bind index,pager W          noop # clear-flag                      clear a status flag from a message
bind index,pager b          noop # bounce-message                  remail a message to another user
bind index,pager d          noop # delete-message                  delete a message
bind index,pager p          noop # print-message                   print the current entry
bind index,pager m          noop # mail                            compose a new message
bind index,pager s          noop # save-message                    save message/attachment to a mailbox/file
bind index,pager w          noop # set-flag                        set a status flag on a message
bind index,pager y          noop # <macro>                         show incoming mailboxes list
bind index,pager |          noop # pipe-message                    pipe message/attachment to a shell command
bind pager a                noop # create-alias                    create an alias from a message sender
bind pager c                noop # change-folder                   open a different folder
bind pager i                noop # exit                            exit this menu

bind  index,pager g        noop
bind  index,pager gn       next-unread
bind  index,pager <down>   sidebar-next
bind  index,pager <up>     sidebar-prev
bind  index,pager <right>  sidebar-open
bind  index,pager \Cu      previous-page
bind  index,pager \Cd      next-page
macro index,pager gi       "<change-folder>=$my_profile/inbox<enter>"              "go to Inbox"
macro index,pager ga       "<change-folder>=$my_profile/archive<enter>"            "go to Archive"
macro index,pager gs       "<change-folder>=$my_profile/sent<enter>"            "go to Starred"

folder-hook .       'bind  index,pager D noop'
folder-hook archive 'macro index,pager D "<save-message>=$my_profile/trash<enter>" "Trash a message"'

folder-hook .       'macro index,pager y "<enter-command>unset pipe_decode resolve<enter><pipe-message>~/.mutt/bin/mark-as-read-in-archive $my_profile<enter><clear-flag>N<enter-command>set resolve pipe_decode<enter><delete-message>" "Archive a message"'
folder-hook archive 'bind  index,pager y noop'

bind  index <Space>        collapse-thread
bind  index <tab>          sync-mailbox
bind  index d              delete-message
bind  index j              next-entry
bind  index k              previous-entry
bind  index G              last-entry
bind  index N              search-opposite
bind  index r              group-reply
bind  index c              mail
bind  index gN             toggle-new
bind  index gg             first-entry
macro index \Ca            "<shell-escape>~/.mutt/bin/fetch-email<enter>"          "fetch new email"
macro index a              "<limit>all\n"                                          "show all messages (undo limit)"
macro index C              "<copy-message>?<toggle-mailboxes>"                     "copy a message to a mailbox"
macro index M              "<save-message>?<toggle-mailboxes>"                     "move a message to a mailbox"
macro index A              "<shell-escape>~/.mutt/bin/mark-read-mail $my_profile<enter>" "mark all the read mail in the archive"
macro index S              "<shell-escape>~/.mutt/bin/notmuch ~/.mail/temporary/search $my_profile<enter><change-folder-readonly>+temporary/search<enter>" "Search mail (using notmuch)"


bind  pager G              bottom
bind  pager N              search-opposite
bind  pager gg             top
bind  pager j              next-line
bind  pager k              previous-line
bind  pager r              group-reply
bind  pager a              view-attachments
macro pager v              "<pipe-message>urlview<enter>"                          "call urlview to open links"
# TODO: fix
macro index,pager X "<pipe-message>rm -rv ~/.cache/mutt/* ; ripmime -i - -d ~/.cache/mutt/ ; x=$(find ~/.cache/mutt/ -type f -exec  xdg-mime query filetype {} \\; -exec ls {} \\; | grep -A1 text/html | tail -n1 ) ; test -n \$x && xdg-open \$x"

bind  editor <Tab>         complete-query
bind  editor ^T            complete

bind  compose p            postpone-message

bind  attach <return>      view-mailcap


